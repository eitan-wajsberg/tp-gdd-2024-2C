@startuml diagrama-entidad-relacion-BI

/'
    Aclaraciones:
        - Considere no poner la palabra "dimensión" en los nombres de las tablas (por ejemplo, usar solo "tiempo" en lugar de "dimensión_tiempo"). Esto hace los nombres más cortos y claros. Además, el diagrama permite identificar fácilmente qué tablas son hechos y cuáles son dimensiones.

        - La consigna dice: "Se deberán considerar como mínimo las siguientes dimensiones, además de las que el alumno considere convenientes." Por eso, probablemente tengamos que agregar más dimensiones o hechos, o tal vez más atributos en algunas dimensiones.

        - Para avanzar, usé:
            - https://raw.githubusercontent.com/sebastiangilberto/utn-gdd-2c2022-tp/main/tp/der/der_BI.svg
            - Las diapositivas del profesor sobre el modelo de estrella, OLAP y DataWarehouse.

        - No estoy seguro sobre el rango horario y el rango etario. Puede que queden bien como están, tener un atributo para cada tipo o quizas se les ocurra otra idea.

        - Acuerdense de que los tipos datos deben ser los mismos de la tabla principal: "Todas las columnas creadas para las nuevas tablas deberán respetar los mismos tipos de datos de las columnas existentes en la tabla maestra."

        - Tengo dudas sobre si el "producto" debería ser un hecho o una dimensión, o si puede ser ambas cosas en distintas tablas. La misma duda tengo con "publicación".
'/

entity "hecho_venta" {
  * hechoVenta_tiempo_id: INT **<<FK>>**
  * hechoVenta_rangoHorario_id: INT **<<FK>>**
  * hechoVenta_rangoEtario_id: INT **<<FK>>**
  ' * hechoVenta_producto_id: INT **<<FK>>**
  ' * hechoVenta_almacen_id: INT **<<FK>>**
  ' * hechoVenta_cliente_id: INT **<<FK>>**
  --
    * hechoVenta_total: DECIMAL(10, 2)
    ' * hechoVenta_cantidadTotalProductos: INT
}

entity "hecho_pago" {
  * hechoPago_tipoMedioPago_id: INT **<<FK>>**
  * hechoPago_tiempo_id: INT **<<FK>>**
  * hechoPago_rangoEtario_id: INT **<<FK>>** 
  ' * hechoPago_cliente_id: INT **<<FK>>**
  --
    * hechoPago_importe: DECIMAL(18, 2)
}

entity "hecho_envio" {
  * hechoEnvio_tiempo_id: INT **<<FK>>**
  * hechoEnvio_ubicacion_id: INT **<<FK>>**
  ' * hechoEnvio_estado_id: INT **<<FK>>**
  * hechoEnvio_tipoEnvio_id: INT **<<FK>>** 
  --
    * concepto_nombre: NVARCHAR(50)
}


entity "hecho_factura" {
  * hechoFactura_tiempo_id: INT **<<FK>>**
  ' * hechoFactura_usuario_id: INT **<<FK>>** 
  ' * hechoFactura_concepto_id: INT **<<FK>>**
  --
    * hechoFactura_total: DECIMAL(18, 2)
    * hechoFactura_cantidad: DECIMAL(18, 0)
}

entity "hecho_publicacion" {
  * hechoPublicacion_tiempo_id: INT **<<FK>>**
  * hechoPublicacion_rubro_id: INT **<<FK>>**
  ' * hechoPublicacion_almacen_id: INT **<<FK>>**
  ' * hechoPublicacion_producto_id: INT **<<FK>>** 
  --
    * hechoPublicacion_costo: DECIMAL(18, 2)
    * hechoPublicacion_precio: DECIMAL(18, 2) 
}


' no estoy seguro de que sean los mejores tipos de datos para tiempos, pero asi estaban en el ejemplo del profe 
entity "tiempo" {
  * tiempo_id: INT **<<PK>>**
  --
    * tiempo_anio: INT  
    * tiempo_cuatrimestre: INT
    * tiempo_mes: INT
}

entity "ubicacion" {
  * ubicacion_id: INT **<<PK>>**
  --
    * ubicacion_localidad: NVARCHAR(50)
    * ubicacion_provincia: NVARCHAR(50)
}

entity "rango_etario_cliente" {
  * rangoEtarioCliente_id: INT **<<PK>>**
  --
    rangoEtarioCliente_nombre: NVARCHAR(16)
}
note bottom
    Rangos etarios: 
        - JUVENTUD: < 25
        - ADULTEZ_TEMPRANA: [25, 35)
        - ADULTEZ_MEDIA: [35, 50]
        - ADULTEZ_AVANZADA: > 50
end note

entity "rango_horario" {
  * rangoHorario_id: INT **<<PK>>**
  --
    * rangoHorario_nombre: NVARCHAR(9)
}
note bottom
    Rangos horarios: 
        - MADRUGADA: 00:00 - 06:00
        - MAÑANA: 06:00 - 12:00
        - TARDE: 12:00 - 18:00
        - NOCHE: 18:00 - 24:00 
end note

entity "tipo_medio_pago" {
  * tipoMedioPago_id: INT **<<PK>>**
  --
    * tipoMedioPago_nombre: NVARCHAR(50) 
}

entity "tipo_envio" {
  * tipoEnvio_id: INT **<<PK>>**
  --
    * tipoEnvio_nombre: NVARCHAR(50)
}

entity "rubro" {
  * rubro_id: INT **<<PK>>**
  --
    * rubro_descripcion: NVARCHAR(50)
    * rubro_subrubro: NVARCHAR(50)
}

hecho_venta -- tiempo
hecho_venta -- rango_etario_cliente
hecho_venta -- rango_horario

hecho_pago -- tipo_medio_pago
hecho_pago -- rango_etario_cliente
hecho_pago -- tiempo

hecho_envio -- tiempo
hecho_envio -- tipo_envio
hecho_envio -- ubicacion

hecho_factura -- tiempo

hecho_publicacion -- tiempo
hecho_publicacion -- rubro

@enduml